<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>20251129 呂林府喜宴</title>
<style>
/* === 1. 喜帖風格色系 === */
.map-decoration-single {
    position: absolute;
    bottom: -20px; /* 距離底部控制區的距離 */
    left: 50%;
    transform: translateX(-50%); /* 水平置中 */
    max-width: 80%; /* 限制最大寬度 */
    max-height: 120px; /* 限制高度，可以根據圖片大小調整 */
    height: auto;
    z-index: 20;
    pointer-events: none; /* 確保不阻擋點擊地圖 */
    opacity: 1;
}

:root {
    --theme-green: #556B2F;
    --theme-pink: #E8ADAA;
    --theme-pink-light: #F9E8E6; 
    --bg-cream: #FFFCF5;
    --text-dark: #4A4A4A;
    --border-gold: #C5A065;
}

body {
    font-family: "Helvetica", "Noto Serif TC", "Microsoft JhengHei", serif;
    background-color: #e0e0e0;
    margin: 0; padding: 0;
    color: var(--text-dark);
    height: 100vh; 
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

/* === 2. 卡片容器 === */
.invitation-card {
    position: relative;
    width: 90vw;
    max-width: 500px;
    height: 95vh;
    background: var(--bg-cream);
    border-radius: 15px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border: 8px solid white;
    outline: 1px solid #d0d0d0;
}

/* === 3. 標題區 === */
.header-section {
    text-align: center;
    padding: 15px 0 5px 0;
    z-index: 10;
    flex-shrink: 0;
}
.header-title {
    font-size: 1.5rem;
    color: var(--theme-green);
    letter-spacing: 3px;
    margin: 0;
    font-weight: normal;
}
.header-subtitle {
    font-size: 0.9rem;
    color: var(--theme-pink);
    letter-spacing: 1px;
    margin-top: 5px;
}

/* === 4. 地圖區 === */
.map-viewport {
    flex-grow: 1;
    position: relative;
    overflow: auto;
    display: flex;
    justify-content: center;
    align-items: center;
    scrollbar-width: none; 
}
.map-viewport::-webkit-scrollbar { display: none; }

svg {
    width: 100%;
    height: auto;
    max-width: 100%;
    display: block;
    opacity: 0.95;
}

/* === 5. 底部控制區 === */
.control-panel {
    position: relative;
    padding: 20px 25px 30px 25px;
    background: white;
    border-top: 1px solid rgba(0,0,0,0.05);
    z-index: 50; 
    box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
}

.search-container { position: relative; }

/* 搜尋框 */
.search-input {
    width: 100%;
    padding: 15px 20px;
    font-size: 16px;
    border: 1px solid #ddd;
    border-radius: 30px;
    background: #fcfcfc;
    outline: none;
    transition: 0.3s;
    box-sizing: border-box;
    text-align: center;
    font-family: "Microsoft JhengHei", sans-serif;
}
.search-input:focus {
    border-color: var(--theme-pink);
    background: white;
    box-shadow: 0 4px 15px rgba(232, 173, 170, 0.2);
}

/* 下拉選單 */
.search-results {
    position: absolute;
    bottom: 100%;
    left: 0;
    width: 100%;
    max-height: 0;
    background: white;
    border-radius: 15px;
    box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
    overflow-y: auto;
    transition: max-height 0.3s ease-out;
    margin-bottom: 10px;
    border: 1px solid #eee;
}
.search-results.open {
    max-height: 250px;
    border-color: var(--theme-pink);
}

.result-item {
    padding: 12px 20px;
    border-bottom: 1px solid #f5f5f5;
    color: #666;
    cursor: pointer;
    transition: 0.2s;
    font-size: 15px;
}
.result-item:hover {
    background-color: var(--theme-pink-light);
    color: var(--theme-green);
}
.result-item:last-child { border-bottom: none; }

/* === 6. 裝飾與動畫 === */
.decor-leaf {
    position: absolute;
    width: 120px; height: 120px;
    pointer-events: none; z-index: 5; opacity: 0.8;
}
.leaf-top-left { top: 0; left: 0; transform: rotate(0deg); }
.leaf-top-right { top: 0; right: 0; transform: scaleX(-1); }
.leaf-bottom-left { bottom: 80px; left: 0; transform: scaleY(-1); }
.leaf-bottom-right { bottom: 80px; right: 0; transform: scale(-1); }

.venue-border { fill: none; stroke: #E8E8E8; stroke-width: 2; }
.stage-rect { fill: #fff; stroke: var(--theme-green); stroke-width: 1.5; rx: 5; }
.table-circle { fill: white; stroke: #dcdcdc; stroke-width: 2; transition: 0.4s; }
.table-text { fill: #666; font-weight: 900; text-anchor: middle; dominant-baseline: central; pointer-events: none; font-family: "Microsoft JhengHei", sans-serif; }

.table-highlight {
    fill: var(--theme-pink-light);
    stroke: var(--theme-pink);
    stroke-width: 4;
    filter: drop-shadow(0 0 8px rgba(232, 173, 170, 0.6));
}
.table-highlight-text { fill: var(--theme-green); }

/* 路徑樣式 */
.path-line {
    fill: none;
    stroke: var(--theme-pink);
    stroke-width: 4;
    stroke-linecap: round;
    stroke-linejoin: round;
    opacity: 0;
    transition: opacity 0.5s;
}
.path-line.visible { opacity: 1; }

.light-dot {
    fill: var(--theme-green);
    stroke: white; stroke-width: 2;
    filter: drop-shadow(0 0 4px var(--theme-green));
    opacity: 0;
}

.notification-toast {
    position: absolute;
    top: 15%; left: 50%;
    transform: translateX(-50%) scale(0.9);
    background: rgba(255, 255, 255, 0.98);
    padding: 12px 30px;
    border-radius: 50px;
    box-shadow: 0 5px 15px rgba(85, 107, 47, 0.15);
    border: 1px solid var(--theme-pink);
    text-align: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s;
    z-index: 100;
    pointer-events: none;
    min-width: 200px;
}
.notification-toast.show {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(10px) scale(1);
}
.toast-name { font-size: 1.4em; color: var(--theme-green); font-weight: bold; display: block; margin-bottom: 4px; }
.toast-table { font-size: 1.1em; color: #666; }

.target-pulse { transform-origin: center; animation: pulse 2s infinite; }
@keyframes pulse {
    0% { transform: scale(1); opacity: 1; stroke-width: 3; }
    50% { transform: scale(1.1); opacity: 0.7; stroke-width: 5; }
    100% { transform: scale(1); opacity: 1; stroke-width: 3; }
}

/* RWD 手機版修正 (搜尋框固定底部) */
@media (max-width: 768px) {
    .invitation-card { 
        height: 100vh; max-width: none; width: 100%; border-radius: 0; border: none; outline: none;
    }
    .map-viewport {
        position: absolute; 
        top: 80px; left: 0; right: 0; bottom: 100px; /* 留出空間給 footer */
        overflow-y: scroll;
    }
    .control-panel { 
        position: absolute; bottom: 0; left: 0; right: 0; height: 100px; 
        padding: 10px 25px 20px 25px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 55; 
        border-top: 1px solid rgba(0,0,0,0.05); 
    }
    .leaf-bottom-left, .leaf-bottom-right { display: none; }
}
</style>
</head>
<body>

<div class="invitation-card">
    <svg class="decor-leaf leaf-top-left" viewBox="0 0 100 100">
        <path d="M0,0 Q40,10 50,50 T80,90 M10,10 L20,15 M20,25 L30,30 M30,40 L40,45" stroke="#556B2F" stroke-width="2" fill="none" opacity="0.3"/>
        <circle cx="50" cy="50" r="2" fill="#E8ADAA" opacity="0.6"/>
        <circle cx="70" cy="30" r="3" fill="#E8ADAA" opacity="0.5"/>
    </svg>
    <svg class="decor-leaf leaf-top-right" viewBox="0 0 100 100">
        <path d="M0,0 Q40,10 50,50 T80,90 M10,10 L20,15 M20,25 L30,30 M30,40 L40,45" stroke="#556B2F" stroke-width="2" fill="none" opacity="0.3"/>
    </svg>
    <svg class="decor-leaf leaf-bottom-left" viewBox="0 0 100 100" style="width:100px; height:100px;">
        <path d="M0,0 Q40,10 50,50 T80,90 M10,10 L20,15 M20,25 L30,30 M30,40 L40,45" stroke="#556B2F" stroke-width="2" fill="none" opacity="0.3"/>
    </svg>
    <svg class="decor-leaf leaf-bottom-right" viewBox="0 0 100 100" style="width:100px; height:100px;">
        <path d="M0,0 Q40,10 50,50 T80,90 M10,10 L20,15 M20,25 L30,30 M30,40 L40,45" stroke="#556B2F" stroke-width="2" fill="none" opacity="0.3"/>
    </svg>

    <div class="header-section">
        <h1 class="header-title">呂尚恩 & 林怡姿</h1>
        <div class="header-subtitle">請上座</div>
    </div>

    <div class="map-viewport" id="mapWrapper">
        <div class="notification-toast" id="toast">
            <span class="toast-name" id="toastName"></span>
            <span class="toast-table" id="toastTable"></span>
        </div>

        <svg viewBox="0 0 800 1150" id="venueMap">
            <defs>
                <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                    <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                </filter>
                <filter id="paper">
                    <feTurbulence type="fractalNoise" baseFrequency="0.04" numOctaves="5" result="noise"/>
                    <feDiffuseLighting in="noise" lighting-color="#fff" surfaceScale="2">
                        <feDistantLight azimuth="45" elevation="60"/>
                    </feDiffuseLighting>
                </filter>
            </defs>

            <rect x="0" y="0" width="800" height="1150" fill="#fffcf5" filter="url(#paper)" opacity="0.5"/>
            <rect x="20" y="20" width="760" height="1110" class="venue-border" rx="20" />
            <rect x="250" y="50" width="300" height="60" class="stage-rect" />
            <text x="400" y="90" font-size="24" fill="#556B2F" text-anchor="middle" letter-spacing="4" font-family="serif">主舞台</text>
            
            <g id="tablesLayer"></g>
            <path id="guidePath" class="path-line" d="" />
            
            <image id="movingShiba" 
                href="https://i.postimg.cc/wTL1Z0Py/Gemini-Generated-Image-ia31ppia31ppia31-removebg-preview.png" 
                height="200" 
                width="200" 
                x="-100" 
                y="-100" 
                style="opacity: 0; transform-origin: center; pointer-events: none;">
                
                <animateMotion id="dotAnim" dur="2.5s" begin="indefinite" fill="freeze" calcMode="spline" keyTimes="0;1" keySplines="0.42 0 0.58 1">
                    <mpath href="#guidePath" />
                </animateMotion>
                
                <animate attributeName="opacity" values="0;1;1;0" keyTimes="0;0.1;0.9;1" dur="2.5s" begin="dotAnim.begin" fill="freeze" />
            </image>
        </svg>
        <img id="single-decor" class="map-decoration-single" 
             src="https://i.postimg.cc/Dzddh7MP/tu-pian-11.png" 
             alt="底部中央裝飾">
    </div>

    <div class="control-panel">
        <div class="search-container">
            <div class="search-results" id="searchResults"></div>
            <input type="text" class="search-input" id="searchInput" 
                   placeholder="請輸入姓名查詢座位..." 
                   oninput="handleSearch()" 
                   onclick="handleSearch()"
                   autocomplete="off">
        </div>
    </div>
</div>

<script>
// === 1. 賓客資料 (完整保留) ===
const guestDataRaw = [
    { table: "主桌", names: ["曾宗敏 舅舅", "潘亮如 舅媽", "曾美珠 大姨", "呂武南", "曾蕉治", "林添裕", "陳姿靚", "林森 爺爺", "黃桃 奶奶", "呂尚恩", "林怡姿", "豪美姑姑"] },
    { table: "大姑姑闔家", names: ["林德城 大姑丈闔家"] },
    { table: "添裕的朋友", names: ["水電郭", "詹老師", "茂森", "張醫師", "邱源志"] }, 
    { table: "姿靚的朋友", names: ["大舅媽", "四舊媽", "小鳳阿姨"] }, 
    { table: "逼零二", names: ["曾莉晴", "周靖婷", "蔡宜汝", "林建廷", "李欣育", "黃士剛", "劉又瑄"] }, 
    { table: "我的少女時代", names: ["淑靜", "貴婦文琪", "黃郁倫", "李兆家", "林巧涵", "蘇慧娟"] }, 
    { table: "說愛你", names: ["陳安信", "莊維澤", "程慧晶", "孫瑋彤+陳書郁", "瑞成", "李昕諭（虎克）", "林家伃"] }, 
    { table: "光復高雄", names: ["陳麒", "鄭宇", "黃靖崴", "胡家瑋", "洪韻筑", "翁瑄禮", "江怡萱", "葉芮羽"] }, 
    { table: "59期A組", names: ["陳一誠", "翁嘉隆", "羅文鴻", "尤彥傑", "羅佾德", "陳金鴻"] }, 
    { table: "河東獅夥伴", names: ["張嘉芳", "戴筌宇", "陳芷萱", "蔣文萱", "鄭宇鈜", "吳俞玲", "林英奇", "胡慧滿"] }, 
    { table: "曾經刑十庭", names: ["林芳如", "白惠淑", "吳珈禎"] }, 
    { table: "長庚家福_1", names: ["蕉治親友 長庚家福"] },
    { table: "長庚家福_2", names: ["蕉治親友 長庚家福"] },
    { table: "曾氏宗親會_1", names: ["曾宗敏 舅舅闔家", "郭火木 大姨丈闔家", "呂國舜 姨丈闔家", "呂宜庭"] },
    { table: "二位姑姑家", names: ["呂惠珍 二姑姑闔家", , "陳惠娟 小姑姑闔家"] },
    { table: "曾氏宗親會_2", names: ["莊有義 二姨丈闔家"] },
    { table: "河東獅長官", names: ["陳麗琇 主任闔家", "李育信 庭長闔家", "李宛凌 主任", "呂建興 主任", "林志祐 襄閱", "謝長夏 主任", "黃昭翰 學長闔家", "董秀菁 主任"] },
    { table: "瘋狂四一六", names: ["黃嬿如 學姊", "李侑姿 主任闔家", "宋文宏 襄閱闔家", "張志宏 帥哥", "張良鏡 帥哥", "陳彥丞 帥哥", "邱宥鈞 帥哥"] },
    { table: "不正經學長", names: ["王建中 學長", "范家振 學長", "蔡杰承 主任闔家", "蘇恒毅 主任闔家", "陳永盛 學長", "張雅婷 學姊"] },
    { table: "六＿十＿期", names: ["邱蓓真 媽咪", "陳郁雯 太太", "戴旻諺 總長", "詹皇輝 大律師", "黃虹蓁 青梅竹馬", "顏鸝靚 大美女", "侯慶忠 帥哥闔家", "蔡旻諺 學長闔家"] },
    { table: "六十期唉組", names: ["王雪君 太太", "陳䊹伊 越南王", "曾亭瑋 波波媽咪", "李佩宣 美女 ", "吳昭億 胖子", "許家菱 捧花得主", "蔡明峰 帥哥"] },
    { table: "法務部長官", names: ["劉慕珊 主任", "姚崇略 長官", "余彬誠 主任", "劉建志 主任", "許萃華 學姊", "甘若蘋 主任", "黃元冠 檢察長", "楊碧瑛 分署長","朱家崎 檢察長", "高碧霞 老師"] },
    { table: "法律一〇五", names: ["劉誠夫 律師", "鍾守軒 設計師", "魏禮 巨巨", "劉俊强 歐爸", "劉育杰 老闆", "謝佳君 媽咪", "蔣瑞安 律師", "廖強志 律師"] },
    { table: "歡樂三一〇", names: ["高翊銘 長官", "魏今芸 媽咪", "游慧玟 媽咪", "黃泓儒 帥哥", "黃品叡 帥哥", "邱柏彰 帥哥", "劉虹汝 老師"] },
    { table: "刑事比人強", names: ["徐崇育", "蘇詠群", "鄭羽成", "黃健銘", "朱子賢"] },
    { table: "26", names: ["小吱爸親戚(備用)"] },
    { table: "27", names: ["親友27"] }
];

let guestData = [];
guestDataRaw.forEach(group => {
    group.names.forEach(name => {
        guestData.push({ name: name, table: group.table });
    });
});
guestData.sort((a, b) => a.name.localeCompare(b.name, "zh-TW"));

// === 2. 桌次座標 ===
const tableCoords = {
    "二位姑姑家": {x: 190, y: 250}, "曾氏宗親會_1": {x: 190, y: 380}, "河東獅長官": {x: 190, y: 510}, "不正經學長": {x: 190, y: 640}, "歡樂三一〇": {x: 190, y: 770}, "刑事比人強": {x: 190, y: 900}, "曾氏宗親會_2": {x: 80, y: 300},
    "主桌": {x: 400, y: 200}, "大姑姑闔家": {x: 300, y: 300}, "法務部長官": {x: 300, y: 430}, "瘋狂四一六": {x: 300, y: 560}, "六＿十＿期": {x: 300, y: 690}, "六十期唉組": {x: 300, y: 820}, "法律一〇五": {x: 300, y: 950},
    "添裕的親戚1": {x: 500, y: 300}, "說愛你": {x: 500, y: 430}, "光復高雄": {x: 500, y: 560}, "59期A組": {x: 500, y: 690}, "我的少女時代": {x: 500, y: 820}, "台大逼零二": {x: 500, y: 950},
    "姿靚的朋友": {x: 610, y: 250}, "添裕的朋友": {x: 610, y: 380}, "河東獅夥伴": {x: 610, y: 510}, "曾經刑十庭": {x: 610, y: 640}, "長庚家福_1": {x: 610, y: 770}, "長庚家福_2": {x: 610, y: 900},
    "添裕的親戚2": {x: 720, y: 300}
};

const tablesLayer = document.getElementById('tablesLayer');
const resultsDiv = document.getElementById('searchResults');
const guidePath = document.getElementById('guidePath');
const dotAnim = document.getElementById('dotAnim');
const toast = document.getElementById('toast');
const toastName = document.getElementById('toastName');
const toastTable = document.getElementById('toastTable');
const searchInput = document.getElementById('searchInput');

// 繪製桌子
function drawTables() {
    for (const [id, pos] of Object.entries(tableCoords)) {
        const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
        let radius = 44; 
        let fontSize = 22; 

        if (id === "主桌") { radius = 70; fontSize = 32; } 
        else {
            if (id.length > 5) fontSize = 18;
            else if (id.length > 4) fontSize = 20;
            else fontSize = 22;
        }
        
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", pos.x); circle.setAttribute("cy", pos.y);
        circle.setAttribute("r", radius); circle.setAttribute("class", "table-circle");
        circle.setAttribute("id", "t-" + id);

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", pos.x); text.setAttribute("y", pos.y);
        text.setAttribute("class", "table-text"); text.setAttribute("id", "txt-" + id);
        text.setAttribute("font-size", fontSize);
        text.textContent = id;

        g.appendChild(circle); g.appendChild(text);
        tablesLayer.appendChild(g);
    }
}

// 處理搜尋
function handleSearch() {
    const filter = searchInput.value;
    resultsDiv.innerHTML = "";
    
    let count = 0;
    let seen = new Set();

    guestData.forEach(g => {
        if (g.name.includes(filter) && !seen.has(g.name + g.table)) {
            seen.add(g.name + g.table);
            const item = document.createElement("div");
            item.className = "result-item";
            item.innerText = g.name;
            item.onclick = () => selectGuest(g.name, g.table);
            resultsDiv.appendChild(item);
            count++;
        }
    });

    if (count > 0 || filter === "") {
        resultsDiv.classList.add('open');
    } else {
        resultsDiv.classList.remove('open');
    }
}

document.addEventListener('click', function(e) {
    if (!document.querySelector('.search-container').contains(e.target)) {
        resultsDiv.classList.remove('open');
    }
});

// ==========================================
// 3. 安全隨機路徑演算法 (Safe Random Path)
// ==========================================
function getSafeRandomPath(targetX, targetY) {
    const startX = 400; // 入口 X
    const startY = 1130; // 入口 Y
    let d = `M ${startX} ${startY}`;

    // 計算垂直距離
    const distY = startY - targetY;
    
    // 隨機漫步參數
    const steps = 4; // 切成 4 段來走，模擬走路擺動
    let curX = startX;
    let curY = startY;

    for (let i = 1; i <= steps; i++) {
        const progress = i / steps;
        // 計算下一段的目標 Y
        const nextY = startY - (distY * progress);
        
        // 隨機 X：嚴格限制在中央走道安全區 (370 ~ 430)
        // 這樣保證不會撞到左右兩邊的桌子 (桌子邊緣約在 344 和 456)
        const jitter = (Math.random() * 20) - 10; // 限制擺動範圍在 +/- 10 像素
        let nextX = 400 + jitter;
        // 如果是最後一步 (i === steps)，我們要回到或接近目標的 X 軸位置準備轉彎
        // 或者我們保持在走道，等最後一個 curve 再轉進去
        if (i === steps) {
            // 保持在走道中心附近，準備最後轉彎
            nextX = 400; 
        }

        // 使用貝茲曲線連接，讓走路軌跡平滑 (S型)
        const cp1x = curX;
        const cp1y = (curY + nextY) / 2;
        const cp2x = nextX;
        const cp2y = (curY + nextY) / 2;

        d += ` C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${nextX} ${nextY}`;

        curX = nextX;
        curY = nextY;
    }

    // 最後一段：轉彎進桌子 (Final Turn)
    // 此時我們在 (curX, targetY) 附近，也就是走道上，跟桌子同一排
    // 我們畫一個帶有隨機弧度的線連到桌子中心，避免看起來像直線穿牆
    
    // 隨機決定弧度是往上拱還是往下拱，增加趣味
    const arcHeight = (Math.random() > 0.5 ? 40 : -40);
    const cpFinalX = (curX + targetX) / 2; // 控制點 X 在中間
    const cpFinalY = targetY + arcHeight;  // 控制點 Y 稍微偏移
    
    d += ` Q ${cpFinalX} ${cpFinalY}, ${targetX} ${targetY}`;

    return d;
}


// 選擇賓客
function selectGuest(name, tableId) {
    const target = tableCoords[tableId];
    if (!target) return;

    searchInput.value = name;
    resultsDiv.classList.remove('open');
    
    document.querySelectorAll('.table-circle').forEach(c => c.classList.remove('table-highlight', 'target-pulse'));
    document.querySelectorAll('.table-text').forEach(t => t.classList.remove('table-highlight-text'));
    toast.classList.remove('show');

    toastName.innerText = name;
    toastTable.innerText = `請入席 ${tableId}`;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 4000);

    // 使用新的隨機路徑生成函式
    const pathD = getSafeRandomPath(target.x, target.y);
    
    guidePath.setAttribute("d", pathD);
    guidePath.classList.add("visible");

    const dot = document.getElementById('movingShiba');
    dot.style.display = 'none';
    void dot.offsetWidth;
    dot.style.display = 'block';
    dotAnim.beginElement();

    setTimeout(() => {
        const tCircle = document.getElementById("t-" + tableId);
        const tText = document.getElementById("txt-" + tableId);
        if(tCircle) {
            tCircle.classList.add('table-highlight', 'target-pulse');
            tText.classList.add('table-highlight-text');
        }
    }, 2500);
}

drawTables();
</script>
</body>
</html>
